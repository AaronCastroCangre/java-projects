# =============================================================================
# MAKEFILE - TODO LIST API
# =============================================================================
# Comandos Ãºtiles para ejecutar y gestionar la aplicaciÃ³n.
#
# Uso: make <comando>
# Ejemplo: make run
# =============================================================================

.PHONY: help install run dev clean build test db-start db-stop db-logs db-reset all

# Comando por defecto: mostrar ayuda
help:
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘                    TODO LIST API - COMANDOS                     â•‘"
	@echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
	@echo "â•‘  APLICACIÃ“N                                                     â•‘"
	@echo "â•‘    make install    - Instalar dependencias                      â•‘"
	@echo "â•‘    make run        - Ejecutar la aplicaciÃ³n                     â•‘"
	@echo "â•‘    make dev        - Ejecutar en modo desarrollo                â•‘"
	@echo "â•‘    make build      - Compilar el proyecto (JAR)                 â•‘"
	@echo "â•‘    make test       - Ejecutar tests                             â•‘"
	@echo "â•‘    make clean      - Limpiar archivos compilados                â•‘"
	@echo "â•‘                                                                 â•‘"
	@echo "â•‘  BASE DE DATOS (Docker)                                         â•‘"
	@echo "â•‘    make db-start   - Iniciar PostgreSQL                         â•‘"
	@echo "â•‘    make db-stop    - Detener PostgreSQL                         â•‘"
	@echo "â•‘    make db-logs    - Ver logs de PostgreSQL                     â•‘"
	@echo "â•‘    make db-reset   - Reiniciar PostgreSQL (elimina datos)       â•‘"
	@echo "â•‘                                                                 â•‘"
	@echo "â•‘  ATAJOS                                                         â•‘"
	@echo "â•‘    make all        - Iniciar BD + Ejecutar aplicaciÃ³n           â•‘"
	@echo "â•‘    make stop       - Detener todo                               â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""

# -----------------------------------------------------------------------------
# APLICACIÃ“N
# -----------------------------------------------------------------------------

# Instalar dependencias
install:
	@echo "ğŸ“¦ Instalando dependencias..."
	mvn dependency:resolve

# Ejecutar la aplicaciÃ³n
run:
	@echo "ğŸš€ Iniciando aplicaciÃ³n..."
	mvn spring-boot:run

# Ejecutar en modo desarrollo (con profile dev)
dev:
	@echo "ğŸ”§ Iniciando en modo desarrollo..."
	mvn spring-boot:run -Dspring-boot.run.profiles=dev

# Compilar el proyecto
build:
	@echo "ğŸ”¨ Compilando proyecto..."
	mvn clean package -DskipTests
	@echo "âœ… JAR generado en: target/todo-list-api-1.0.0-SNAPSHOT.jar"

# Ejecutar tests
test:
	@echo "ğŸ§ª Ejecutando tests..."
	mvn test

# Limpiar archivos compilados
clean:
	@echo "ğŸ§¹ Limpiando archivos compilados..."
	mvn clean

# -----------------------------------------------------------------------------
# BASE DE DATOS (Docker)
# -----------------------------------------------------------------------------

# Iniciar PostgreSQL
db-start:
	@echo "ğŸ˜ Iniciando PostgreSQL..."
	docker-compose up -d
	@echo "âœ… PostgreSQL iniciado en puerto 5432"

# Detener PostgreSQL
db-stop:
	@echo "ğŸ›‘ Deteniendo PostgreSQL..."
	docker-compose down
	@echo "âœ… PostgreSQL detenido"

# Ver logs de PostgreSQL
db-logs:
	docker-compose logs -f postgres

# Reiniciar PostgreSQL (elimina datos)
db-reset:
	@echo "âš ï¸  Reiniciando PostgreSQL (se eliminarÃ¡n todos los datos)..."
	docker-compose down -v
	docker-compose up -d
	@echo "âœ… PostgreSQL reiniciado"

# Estado de la base de datos
db-status:
	@docker-compose ps

# -----------------------------------------------------------------------------
# ATAJOS
# -----------------------------------------------------------------------------

# Iniciar todo (BD + App)
all: db-start
	@echo "â³ Esperando a que PostgreSQL estÃ© listo..."
	@sleep 3
	@make run

# Detener todo
stop: db-stop
	@echo "âœ… Todo detenido"
